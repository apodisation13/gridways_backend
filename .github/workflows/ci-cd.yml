name: ci-cd gridways backend

on:
  pull_request:
    branches: [ main, testing ]
    types: [opened, synchronize, closed]

  workflow_dispatch:
    inputs:
      environment:
        description: 'Ð¦ÐµÐ»ÐµÐ²Ð¾Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ'
        required: true
        default: 'testing'
        type: choice
        options:
          - testing
          - production

env:
  REGISTRY: ghcr.io
  IMAGE_PREFIX: ${{ github.repository }}


jobs:
  validate-if-pr-to-main-from-testing-only:
    runs-on: ubuntu-latest
    outputs:
      pr_valid: ${{ steps.validate.outputs.valid }}
    steps:
      - name: Check PR to main is from testing only
        id: validate
        run: |
          echo "ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Pull Request..."
          echo "Ð¦ÐµÐ»ÐµÐ²Ð°Ñ Ð²ÐµÑ‚ÐºÐ°: ${{ github.base_ref }}"
          echo "Ð˜ÑÑ…Ð¾Ð´Ð½Ð°Ñ Ð²ÐµÑ‚ÐºÐ°: ${{ github.head_ref }}"
          
          if [[ "${{ github.base_ref }}" == "main" && "${{ github.head_ref }}" != "testing" ]]; then
            echo "âŒ PR to main can only be from testing branch"
            echo "valid=false" >> $GITHUB_OUTPUT
            exit 1
          fi
          
          echo "âœ… Valid PR: main â† testing"
          echo "valid=true" >> $GITHUB_OUTPUT

  linters-and-tests:
    needs: validate-if-pr-to-main-from-testing-only
    if: needs.validate-if-pr-to-main-from-testing-only.outputs.pr_valid == 'true'
    runs-on: ubuntu-latest

    services:
      postgres:
        image: postgres:13
        env:
          POSTGRES_USER: postgres
          POSTGRES_PASSWORD: postgres_password
          POSTGRES_DB: test_db
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
        ports:
          - 5432:5432

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r lib/requirements-dev.txt
        pip install -r services/api/requirements.txt
        pip install -r services/cron/requirements.txt
        pip install -r services/events/requirements.txt
        pip install -r services/migrant/requirements.txt
        pip install -r services/rest/requirements.txt

    - name: Create test environment file
      run: |
        cat > .env << EOF
        CONFIG=test_local
        TEST_DB_PASSWORD=postgres_password
        EOF
        echo "âœ… Created .env file"

    - name: Run ruff check
      run: |
        echo "ðŸ” Checking code with ruff..."

        echo "ðŸ“‹ Running ruff check..."
        ruff check .
        if [ $? -ne 0 ]; then
          echo "âŒ Linting issues found!"
          echo "Please run 'ruff check --fix .' locally and commit the changes"
          exit 1
        fi
        echo "âœ… Linting passed"

        echo "ðŸ“‹ Running ruff format check..."
        ruff format --check .
        if [ $? -ne 0 ]; then
          echo "âŒ Code formatting issues found!"
          echo "Please run 'ruff format .' locally and commit the changes"
          exit 1
        fi
        echo "âœ… Code formatting is correct"

        echo "ðŸŽ‰ All checks passed!"

    - name: Run tests
      run: |
        pytest -s -vv

  analyze-changes:
    if: github.event_name != 'workflow_dispatch'
    needs: linters-and-tests
    runs-on: ubuntu-latest
    outputs:
      services_to_build: ${{ steps.detect.outputs.services }}
      build_all: ${{ steps.detect.outputs.build_all }}
      services_json: ${{ steps.detect.outputs.services_json }}

    steps:
      - name: ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ÐºÐ¾Ð´
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ÐÐ½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐµÐ¼ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ
        id: detect
        run: |
          ALL_SERVICES_LIST="migrant,api,rest,events,cron"
          
          echo "ðŸ” ÐÐ½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐµÐ¼ Ñ‡Ñ‚Ð¾ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»Ð¾ÑÑŒ Ð² PR..."
          
          # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹
          CHANGED_FILES=$(git diff --name-only ${{ github.event.pull_request.base.sha }}...${{ github.event.pull_request.head.sha }})
          echo "ðŸ“„ Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹:"
          echo "$CHANGED_FILES"
          echo ""
          
          # ÐŸÐ ÐÐ’Ð˜Ð›Ðž 1: Ð˜Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼ ÐµÑÐ»Ð¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‚ÐµÑÑ‚Ñ‹
          ONLY_TESTS=true
          for file in $CHANGED_FILES; do
            if [[ ! $file =~ /tests/ ]] && [[ ! $file =~ ^lib/tests/ ]]; then
              ONLY_TESTS=false
            fi
          done
          
          if [[ "$ONLY_TESTS" == "true" ]]; then
            echo "ðŸ“ Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ñ‚ÐµÑÑ‚Ñ‹ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ñ‹ - Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð±Ð¸Ð»Ð´Ð¸Ð¼"
            echo "services=" >> $GITHUB_OUTPUT
            echo "build_all=false" >> $GITHUB_OUTPUT
            exit 0
          fi
          
          # ÐŸÐ ÐÐ’Ð˜Ð›Ðž 2: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ lib/utils (ÐºÑ€Ð¾Ð¼Ðµ models)
          LIB_UTILS_CHANGED=false
          for file in $CHANGED_FILES; do
            if [[ $file =~ ^lib/utils/ ]] && [[ ! $file =~ ^lib/utils/models/ ]]; then
              LIB_UTILS_CHANGED=true
            fi
          done
          
          if [[ "$LIB_UTILS_CHANGED" == "true" ]]; then
            echo "ðŸ“š Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ñ‹ Ð¾Ð±Ñ‰Ð¸Ðµ ÑƒÑ‚Ð¸Ð»Ð¸Ñ‚Ñ‹ - Ð±Ð¸Ð»Ð´Ð¸Ð¼ Ð’Ð¡Ð• ÑÐµÑ€Ð²Ð¸ÑÑ‹"
            echo "build_all=true" >> $GITHUB_OUTPUT
            echo "services=migrant,api,rest,events,cron" >> $GITHUB_OUTPUT
            exit 0
          fi
          
          # ÐŸÐ ÐÐ’Ð˜Ð›Ðž 3: ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÐ¼ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð½Ñ‹Ðµ ÑÐµÑ€Ð²Ð¸ÑÑ‹
          echo "ðŸ”Ž Ð˜Ñ‰ÐµÐ¼ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð½Ñ‹Ðµ Ð¼Ð¸ÐºÑ€Ð¾ÑÐµÑ€Ð²Ð¸ÑÑ‹..."
          CHANGED_SERVICES=""
          
          # Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð²ÑÐµÑ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²
          ALL_SERVICES=("migrant" "api" "rest" "events" "cron")
          
          for service in "${ALL_SERVICES[@]}"; do
            for file in $CHANGED_FILES; do
              if [[ $file =~ ^services/$service/ ]] && [[ ! $file =~ ^services/$service/tests/ ]]; then
                echo "âœ… Ð¡ÐµÑ€Ð²Ð¸Ñ '$service' Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»ÑÑ"
                CHANGED_SERVICES="$CHANGED_SERVICES$service,"
                break
              fi
            done
          done
          
          # Ð£Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð·Ð°Ð¿ÑÑ‚ÑƒÑŽ
          CHANGED_SERVICES=${CHANGED_SERVICES%,}
          
          echo "ðŸ“¦ Ð¡ÐµÑ€Ð²Ð¸ÑÑ‹ Ð´Ð»Ñ ÑÐ±Ð¾Ñ€ÐºÐ¸: $CHANGED_SERVICES"
          echo "services=$CHANGED_SERVICES" >> $GITHUB_OUTPUT
          echo "build_all=false" >> $GITHUB_OUTPUT
          
          if [[ -n "$CHANGED_SERVICES" ]]; then
            # Ð¡Ð¿Ð¾ÑÐ¾Ð± 1: Ð§ÐµÑ€ÐµÐ· sed Ð¸ tr (Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹)
            SERVICES_JSON="[\"$(echo "$CHANGED_SERVICES" | sed 's/,/","/g')\"]"
            echo "âœ… ÐŸÑ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¾ Ð² JSON: $SERVICES_JSON"
            echo "services_json=$SERVICES_JSON" >> $GITHUB_OUTPUT
          else
            echo "services_json=[]" >> $GITHUB_OUTPUT
          fi

  build-images:
    needs: [ linters-and-tests, analyze-changes ]
    if: |
      github.event_name == 'pull_request' &&
      github.event.action == 'closed' &&
      github.event.pull_request.merged == true &&
      needs.analyze-changes.outputs.services_to_build != ''

    runs-on: ubuntu-latest

    # ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÐ¼ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ Ð¿Ð¾ Ñ†ÐµÐ»ÐµÐ²Ð¾Ð¹ Ð²ÐµÑ‚ÐºÐµ
    environment: ${{ github.base_ref == 'main' && 'production' || 'testing' }}

    strategy:
      matrix:
        service: ${{ fromJson(needs.analyze-changes.outputs.services_json) }}

    steps:
      - name: ðŸ“¥ ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ÐºÐ¾Ð´
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.merge_commit_sha }}

      - name: ðŸ·ï¸ ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÐ¼ Ñ‚ÐµÐ³
        id: vars
        run: |
          if [[ "${{ github.base_ref }}" == "main" ]]; then
            echo "tag=production" >> $GITHUB_OUTPUT
            echo "ðŸ·ï¸ ÐžÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ: production"
          else
            echo "tag=testing" >> $GITHUB_OUTPUT
            echo "ðŸ·ï¸ ÐžÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ: testing"
          fi

      - name: ðŸ”§ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: ðŸ” Ð›Ð¾Ð³Ð¸Ð½ Ð² GitHub Container Registry
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: ðŸ”¨ Ð‘Ð¸Ð»Ð´ Ð¸ Ð¿ÑƒÑˆ Ð¾Ð±Ñ€Ð°Ð·Ð°
        run: |
          export TAG="${{ steps.vars.outputs.tag }}"
          
          echo "ðŸ”¨ Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼: ${{ matrix.service }}"
          echo "ðŸ·ï¸ Ð¢ÐµÐ³: $TAG"
          
          docker-compose build ${{ matrix.service }}
          docker-compose push ${{ matrix.service }}
          
          echo "âœ… ${{ matrix.service }}:$TAG Ð³Ð¾Ñ‚Ð¾Ð²!"

  # ==========================================
  # ðŸš€ Ð”Ð•ÐŸÐ›ÐžÐ™ (Ð¿Ð¾ÑÐ»Ðµ Ð²ÑÐµÑ… Ð±Ð¸Ð»Ð´Ð¾Ð²)
  # ==========================================
  deploy:
    needs: [ analyze-changes, build-images ]
    if: |
      github.event_name == 'pull_request' &&
      github.event.action == 'closed' &&
      github.event.pull_request.merged == true &&
      needs.analyze-changes.outputs.services_to_build != ''

    runs-on: ubuntu-latest

    environment: ${{ github.base_ref == 'main' && 'production' || 'testing' }}
    env:
      MODE: ${{ github.ref_name == 'main' && 'production' || 'testing' }}

    steps:
      - name: ðŸ·ï¸ ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÐ¼ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ
        id: vars
        run: |
          if [[ "${{ github.base_ref }}" == "main" ]]; then
            echo "tag=production" >> $GITHUB_OUTPUT
          else
            echo "tag=testing" >> $GITHUB_OUTPUT
          fi

      - name: Send docker-compose
        uses: appleboy/scp-action@v0.1.7
        with:
          host: ${{ secrets.SSH_SERVER }}
          username: ${{ secrets.SSH_USER }}
          key: ${{ secrets.SSH_KEY }}
          source: "docker-compose.yml"
          target: "/srv/cardgame/backend/${{ env.MODE }}"

      - name: ðŸš€ Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€
        uses: appleboy/ssh-action@v1
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            echo "ðŸš€ Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð½Ð° ${{ steps.vars.outputs.tag }}"
            
            cd ${{ secrets.PROJECT_PATH }}
            
            export TAG="${{ steps.vars.outputs.tag }}"
            
            # Ð›Ð¾Ð³Ð¸Ð½ Ð² registry
            echo "${{ secrets.GITHUB_TOKEN }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin
            
            # ÐŸÑƒÐ»Ð»Ð¸Ð¼ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¸Ð·Ð¼ÐµÐ½Ñ‘Ð½Ð½Ñ‹Ðµ ÑÐµÑ€Ð²Ð¸ÑÑ‹
            echo "ðŸ“¥ ÐŸÑƒÐ»Ð»Ð¸Ð¼: ${{ needs.analyze-changes.outputs.services_to_build }}"
            docker-compose pull ${{ needs.analyze-changes.outputs.services_to_build }}
            
            # ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼
            echo "ðŸ”„ ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ ÑÐµÑ€Ð²Ð¸ÑÑ‹..."
            docker-compose up -d
            
            # Ð§Ð¸ÑÑ‚Ð¸Ð¼
            docker image prune -f
            
            echo ""
            echo "âœ… Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð·Ð°Ð²ÐµÑ€ÑˆÑ‘Ð½!"
            docker-compose ps  
  

  # ==========================================
  # ðŸ–ï¸ Ð Ð£Ð§ÐÐžÐ™ Ð¤Ð›ÐžÐ£ (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ workflow_dispatch)
  # ==========================================
  manual-build-and-deploy:
    if: github.event_name == 'workflow_dispatch'
    needs: linters-and-tests
    runs-on: ubuntu-latest

    environment: ${{ github.event.inputs.environment }}
    env:
      MODE: ${{ github.event.inputs.environment }}

    steps:
      - name: ðŸ“¥ ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ÐºÐ¾Ð´
        uses: actions/checkout@v4

      - name: ðŸ” Ð›Ð¾Ð³Ð¸Ð½ Ð² GitHub Container Registry
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: ðŸ” Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ .env Ð¸Ð· Environment secrets
        run: |
          cat > .env << EOF
          CONFIG=${{ secrets.CONFIG }}
          DB_PORT_OUTSIDE=${{ secrets.DB_PORT_OUTSIDE }}
          DB_NAME=${{ secrets.DB_NAME }}
          DB_USER=${{ secrets.DB_USER }}
          DB_PASSWORD=${{ secrets.DB_PASSWORD }}
          DJANGO_SUPERUSER_USERNAME=${{ secrets.DJANGO_SUPERUSER_USERNAME }}
          DJANGO_SUPERUSER_EMAIL=${{ secrets.DJANGO_SUPERUSER_EMAIL }}
          DJANGO_SUPERUSER_PASSWORD=${{ secrets.DJANGO_SUPERUSER_PASSWORD }}
          ELASTIC_PASSWORD=${{ secrets.ELASTIC_PASSWORD }}
          KIBANA_SYSTEM_PASSWORD=${{ secrets.KIBANA_SYSTEM_PASSWORD }}
          APM_SECRET_TOKEN=${{ secrets.APM_SECRET_TOKEN }}
          APP_PORT_OUTSIDE=${{ secrets.APP_PORT_OUTSIDE }}
          EOF
          
          echo "âœ… .env ÑÐ¾Ð·Ð´Ð°Ð½ Ð´Ð»Ñ Environment: ${{ env.MODE }}"

      - name: ðŸ”¨ Ð‘Ð¸Ð»Ð´Ð¸Ð¼ ÑÐ²Ð¾Ð¸ ÑÐµÑ€Ð²Ð¸ÑÑ‹
        run: |
          export TAG="${{ github.event.inputs.environment }}"
          
          # Ð¡ÐµÑ€Ð²Ð¸ÑÑ‹ Ñƒ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… ÐµÑÑ‚ÑŒ build: Ð² docker-compose
          OUR_SERVICES="migrant api rest events cron"
          
          echo "ðŸš€ Ð‘Ð¸Ð»Ð´Ð¸Ð¼: $OUR_SERVICES"
          echo "ðŸ·ï¸ Ð¢ÐµÐ³: $TAG"
          echo ""
          
          docker compose build $OUR_SERVICES

      - name: ðŸ“¤ ÐŸÑƒÑˆÐ¸Ð¼ Ð¾Ð±Ñ€Ð°Ð·Ñ‹ Ð² registry
        run: |
          export TAG="${{ github.event.inputs.environment }}"
          
          OUR_SERVICES="migrant api rest events cron"
          
          echo "ðŸ“¤ ÐŸÑƒÑˆÐ¸Ð¼ Ð¾Ð±Ñ€Ð°Ð·Ñ‹..."
          docker compose push $OUR_SERVICES
          
          echo "âœ… Ð’ÑÐµ Ð¾Ð±Ñ€Ð°Ð·Ñ‹ Ð² registry!"

      - name: Send docker-compose
        uses: appleboy/scp-action@v0.1.7
        with:
          host: ${{ secrets.SSH_SERVER }}
          username: ${{ secrets.SSH_USER }}
          key: ${{ secrets.SSH_KEY }}
          source: "docker-compose.yaml"
          target: "/srv/cardgame/backend/${{ env.MODE }}"

      - name: ðŸš€ Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€
        uses: appleboy/ssh-action@v1
        with:
          host: ${{ secrets.SSH_SERVER }}
          username: ${{ secrets.SSH_USER }}
          key: ${{ secrets.SSH_KEY }}
          script: |
            echo "ðŸš€ Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð½Ð° ${{ github.event.inputs.environment }}"
            
            cd /srv/cardgame/backend/${{ env.MODE }}
            
            export TAG="${{ github.event.inputs.environment }}"
            
            echo "ðŸ“¥ Ð›Ð¾Ð³Ð¸Ð½Ð¸Ð¼ÑÑ Ð² registry..."
            echo "${{ secrets.GITHUB_TOKEN }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin
            
            echo "ðŸ“¥ ÐŸÑƒÐ»Ð»Ð¸Ð¼ Ð½Ð¾Ð²Ñ‹Ðµ Ð¾Ð±Ñ€Ð°Ð·Ñ‹..."
            docker-compose pull migrant api rest events cron
            
            echo "ðŸ”„ ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ ÑÐµÑ€Ð²Ð¸ÑÑ‹..."
            docker-compose up -d
            
            echo "ðŸ§¹ Ð§Ð¸ÑÑ‚Ð¸Ð¼ ÑÑ‚Ð°Ñ€Ñ‹Ðµ Ð¾Ð±Ñ€Ð°Ð·Ñ‹..."
            docker image prune -f
            
            echo ""
            echo "âœ… Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð·Ð°Ð²ÐµÑ€ÑˆÑ‘Ð½!"
            docker-compose ps

      - name: ðŸ“‹ Ð˜Ñ‚Ð¾Ð³
        run: |
          echo "=========================================="
          echo "âœ… Ð ÑƒÑ‡Ð½Ð¾Ð¹ Ð±Ð¸Ð»Ð´ Ð¸ Ð´ÐµÐ¿Ð»Ð¾Ð¹ Ð·Ð°Ð²ÐµÑ€ÑˆÑ‘Ð½!"
          echo "=========================================="
          echo ""
          echo "ðŸ·ï¸ ÐžÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ: ${{ github.event.inputs.environment }}"
          echo "ðŸ“¦ Ð¡ÐµÑ€Ð²Ð¸ÑÑ‹: migrant, api, rest, events, cron"
          echo "ðŸ–¥ï¸ Ð¡ÐµÑ€Ð²ÐµÑ€: ${{ secrets.SERVER_HOST }}"
